{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar account_1 = require(\"@celo/base/lib/account\");\n\nvar string_1 = require(\"@celo/base/lib/string\");\n\nvar bip32 = __importStar(require(\"bip32\"));\n\nvar bip39 = __importStar(require(\"bip39\"));\n\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\n\nvar randombytes_1 = __importDefault(require(\"randombytes\"));\n\nvar address_1 = require(\"./address\"); // Exports moved to @celo/base, forwarding them\n// here for backwards compatibility\n\n\nvar account_2 = require(\"@celo/base/lib/account\");\n\nexports.CELO_DERIVATION_PATH_BASE = account_2.CELO_DERIVATION_PATH_BASE;\nexports.MnemonicLanguages = account_2.MnemonicLanguages;\nexports.MnemonicStrength = account_2.MnemonicStrength;\n\nfunction defaultGenerateMnemonic(strength, rng, wordlist) {\n  return new Promise(function (resolve, reject) {\n    strength = strength || 128;\n    rng = rng || randombytes_1.default;\n    rng(strength / 8, function (error, randomBytesBuffer) {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(bip39.entropyToMnemonic(randomBytesBuffer.toString('hex'), wordlist));\n      }\n    });\n  });\n}\n\nvar bip39Wrapper = {\n  mnemonicToSeedSync: bip39.mnemonicToSeedSync,\n  mnemonicToSeed: bip39.mnemonicToSeed,\n  generateMnemonic: defaultGenerateMnemonic,\n  validateMnemonic: bip39.validateMnemonic\n};\n\nfunction generateMnemonic(strength, language, bip39ToUse) {\n  if (strength === void 0) {\n    strength = account_1.MnemonicStrength.s256_24words;\n  }\n\n  if (bip39ToUse === void 0) {\n    bip39ToUse = bip39Wrapper;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n      return [2\n      /*return*/\n      , bip39ToUse.generateMnemonic(strength, undefined, getWordList(language))];\n    });\n  });\n}\n\nexports.generateMnemonic = generateMnemonic;\n\nfunction validateMnemonic(mnemonic, bip39ToUse) {\n  if (bip39ToUse === void 0) {\n    bip39ToUse = bip39Wrapper;\n  }\n\n  var languages = getAllLanguages();\n\n  for (var _i = 0, languages_1 = languages; _i < languages_1.length; _i++) {\n    var language = languages_1[_i];\n\n    if (bip39ToUse.validateMnemonic(mnemonic, getWordList(language))) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexports.validateMnemonic = validateMnemonic;\n\nfunction formatNonAccentedCharacters(mnemonic) {\n  var languages = getAllLanguages();\n  var normMnemonicArr = string_1.normalizeAccents(mnemonic).toLowerCase().trim().split(' ');\n\n  for (var _i = 0, languages_2 = languages; _i < languages_2.length; _i++) {\n    var language = languages_2[_i];\n\n    if (isLatinBasedLanguage(language)) {\n      var wordList = getWordList(language);\n      var normWordListMap = createNormalizedWordListMap(wordList);\n      var languageMatches = arrayContainedInMap(normMnemonicArr, normWordListMap);\n\n      if (languageMatches) {\n        return replaceIncorrectlyAccentedWords(mnemonic, normMnemonicArr, normWordListMap);\n      }\n    }\n  }\n\n  return mnemonic;\n}\n\nexports.formatNonAccentedCharacters = formatNonAccentedCharacters;\n\nvar createNormalizedWordListMap = function (wordList) {\n  var normWordListMap = new Map();\n\n  for (var _i = 0, wordList_1 = wordList; _i < wordList_1.length; _i++) {\n    var word = wordList_1[_i];\n    var noramlizedWord = string_1.normalizeAccents(word);\n    normWordListMap.set(noramlizedWord, word);\n  }\n\n  return normWordListMap;\n};\n\nvar arrayContainedInMap = function (array, map) {\n  for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\n    var item = array_1[_i];\n\n    if (!map.has(item)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nvar replaceIncorrectlyAccentedWords = function (mnemonic, normMnemonicArr, normWordListMap) {\n  var mnemonicArr = __spreadArrays(mnemonic.trim().split(' '));\n\n  for (var i = 0; i < normMnemonicArr.length; i += 1) {\n    var noramlizedWord = normMnemonicArr[i];\n    var nonNormalizedWord = normWordListMap.get(noramlizedWord);\n\n    if (nonNormalizedWord) {\n      mnemonicArr[i] = nonNormalizedWord;\n    }\n  }\n\n  return mnemonicArr.join(' ');\n};\n\nfunction generateKeys(mnemonic, password, changeIndex, addressIndex, bip39ToUse, derivationPath) {\n  if (changeIndex === void 0) {\n    changeIndex = 0;\n  }\n\n  if (addressIndex === void 0) {\n    addressIndex = 0;\n  }\n\n  if (bip39ToUse === void 0) {\n    bip39ToUse = bip39Wrapper;\n  }\n\n  if (derivationPath === void 0) {\n    derivationPath = account_1.CELO_DERIVATION_PATH_BASE;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var seed;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , generateSeed(mnemonic, password, bip39ToUse)];\n\n        case 1:\n          seed = _a.sent();\n          return [2\n          /*return*/\n          , generateKeysFromSeed(seed, changeIndex, addressIndex, derivationPath)];\n      }\n    });\n  });\n}\n\nexports.generateKeys = generateKeys;\n\nfunction generateDeterministicInviteCode(recipientPhoneHash, recipientPepper, addressIndex, changeIndex, derivationPath) {\n  if (addressIndex === void 0) {\n    addressIndex = 0;\n  }\n\n  if (changeIndex === void 0) {\n    changeIndex = 0;\n  }\n\n  if (derivationPath === void 0) {\n    derivationPath = account_1.CELO_DERIVATION_PATH_BASE;\n  }\n\n  var seed = ethereumjs_util_1.keccak256(recipientPhoneHash + recipientPepper);\n  return generateKeysFromSeed(seed, changeIndex, addressIndex, derivationPath);\n}\n\nexports.generateDeterministicInviteCode = generateDeterministicInviteCode; // keyByteLength truncates the seed. *Avoid its use*\n// It was added only because a backwards compatibility bug\n\nfunction generateSeed(mnemonic, password, bip39ToUse, keyByteLength) {\n  if (bip39ToUse === void 0) {\n    bip39ToUse = bip39Wrapper;\n  }\n\n  if (keyByteLength === void 0) {\n    keyByteLength = 64;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var seed, bufAux;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , bip39ToUse.mnemonicToSeed(mnemonic, password)];\n\n        case 1:\n          seed = _a.sent();\n\n          if (keyByteLength > 0 && seed.byteLength > keyByteLength) {\n            bufAux = Buffer.allocUnsafe(keyByteLength);\n            seed.copy(bufAux, 0, 0, keyByteLength);\n            seed = bufAux;\n          }\n\n          return [2\n          /*return*/\n          , seed];\n      }\n    });\n  });\n}\n\nexports.generateSeed = generateSeed;\n\nfunction generateKeysFromSeed(seed, changeIndex, addressIndex, derivationPath) {\n  if (changeIndex === void 0) {\n    changeIndex = 0;\n  }\n\n  if (addressIndex === void 0) {\n    addressIndex = 0;\n  }\n\n  if (derivationPath === void 0) {\n    derivationPath = account_1.CELO_DERIVATION_PATH_BASE;\n  }\n\n  var node = bip32.fromSeed(seed);\n  var newNode = node.derivePath(derivationPath + \"/\" + changeIndex + \"/\" + addressIndex);\n\n  if (!newNode.privateKey) {\n    // As we are generating the node from a seed, the node will always have a private key and this would never happened\n    throw new Error('utils-accounts@generateKeys: invalid node to derivate');\n  }\n\n  return {\n    privateKey: newNode.privateKey.toString('hex'),\n    publicKey: newNode.publicKey.toString('hex'),\n    address: address_1.privateKeyToAddress(newNode.privateKey.toString('hex'))\n  };\n}\n\nexports.generateKeysFromSeed = generateKeysFromSeed;\n\nfunction isLatinBasedLanguage(language) {\n  if (language === account_1.MnemonicLanguages.chinese_simplified || language === account_1.MnemonicLanguages.chinese_traditional || language === account_1.MnemonicLanguages.japanese || language === account_1.MnemonicLanguages.korean) {\n    return false;\n  }\n\n  return true;\n} // Unify the bip39.wordlists (otherwise depends on the instance of the bip39)\n\n\nfunction getWordList(language) {\n  switch (language) {\n    case account_1.MnemonicLanguages.chinese_simplified:\n      return bip39.wordlists.chinese_simplified;\n\n    case account_1.MnemonicLanguages.chinese_traditional:\n      return bip39.wordlists.chinese_traditional;\n\n    case account_1.MnemonicLanguages.english:\n      return bip39.wordlists.english;\n\n    case account_1.MnemonicLanguages.french:\n      return bip39.wordlists.french;\n\n    case account_1.MnemonicLanguages.italian:\n      return bip39.wordlists.italian;\n\n    case account_1.MnemonicLanguages.japanese:\n      return bip39.wordlists.japanese;\n\n    case account_1.MnemonicLanguages.korean:\n      return bip39.wordlists.korean;\n\n    case account_1.MnemonicLanguages.spanish:\n      return bip39.wordlists.spanish;\n\n    default:\n      return bip39.wordlists.english;\n  }\n}\n\nfunction getAllLanguages() {\n  return [account_1.MnemonicLanguages.chinese_simplified, account_1.MnemonicLanguages.chinese_traditional, account_1.MnemonicLanguages.english, account_1.MnemonicLanguages.french, account_1.MnemonicLanguages.italian, account_1.MnemonicLanguages.japanese, account_1.MnemonicLanguages.korean, account_1.MnemonicLanguages.spanish];\n}\n\nexports.AccountUtils = {\n  generateMnemonic: generateMnemonic,\n  validateMnemonic: validateMnemonic,\n  generateKeys: generateKeys,\n  generateSeed: generateSeed,\n  generateKeysFromSeed: generateKeysFromSeed\n};","map":{"version":3,"sources":["../src/account.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar account_1 = require(\"@celo/base/lib/account\");\nvar string_1 = require(\"@celo/base/lib/string\");\nvar bip32 = __importStar(require(\"bip32\"));\nvar bip39 = __importStar(require(\"bip39\"));\nvar ethereumjs_util_1 = require(\"ethereumjs-util\");\nvar randombytes_1 = __importDefault(require(\"randombytes\"));\nvar address_1 = require(\"./address\");\n// Exports moved to @celo/base, forwarding them\n// here for backwards compatibility\nvar account_2 = require(\"@celo/base/lib/account\");\nexports.CELO_DERIVATION_PATH_BASE = account_2.CELO_DERIVATION_PATH_BASE;\nexports.MnemonicLanguages = account_2.MnemonicLanguages;\nexports.MnemonicStrength = account_2.MnemonicStrength;\nfunction defaultGenerateMnemonic(strength, rng, wordlist) {\n    return new Promise(function (resolve, reject) {\n        strength = strength || 128;\n        rng = rng || randombytes_1.default;\n        rng(strength / 8, function (error, randomBytesBuffer) {\n            if (error) {\n                reject(error);\n            }\n            else {\n                resolve(bip39.entropyToMnemonic(randomBytesBuffer.toString('hex'), wordlist));\n            }\n        });\n    });\n}\nvar bip39Wrapper = {\n    mnemonicToSeedSync: bip39.mnemonicToSeedSync,\n    mnemonicToSeed: bip39.mnemonicToSeed,\n    generateMnemonic: defaultGenerateMnemonic,\n    validateMnemonic: bip39.validateMnemonic,\n};\nfunction generateMnemonic(strength, language, bip39ToUse) {\n    if (strength === void 0) { strength = account_1.MnemonicStrength.s256_24words; }\n    if (bip39ToUse === void 0) { bip39ToUse = bip39Wrapper; }\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2 /*return*/, bip39ToUse.generateMnemonic(strength, undefined, getWordList(language))];\n        });\n    });\n}\nexports.generateMnemonic = generateMnemonic;\nfunction validateMnemonic(mnemonic, bip39ToUse) {\n    if (bip39ToUse === void 0) { bip39ToUse = bip39Wrapper; }\n    var languages = getAllLanguages();\n    for (var _i = 0, languages_1 = languages; _i < languages_1.length; _i++) {\n        var language = languages_1[_i];\n        if (bip39ToUse.validateMnemonic(mnemonic, getWordList(language))) {\n            return true;\n        }\n    }\n    return false;\n}\nexports.validateMnemonic = validateMnemonic;\nfunction formatNonAccentedCharacters(mnemonic) {\n    var languages = getAllLanguages();\n    var normMnemonicArr = string_1.normalizeAccents(mnemonic)\n        .toLowerCase()\n        .trim()\n        .split(' ');\n    for (var _i = 0, languages_2 = languages; _i < languages_2.length; _i++) {\n        var language = languages_2[_i];\n        if (isLatinBasedLanguage(language)) {\n            var wordList = getWordList(language);\n            var normWordListMap = createNormalizedWordListMap(wordList);\n            var languageMatches = arrayContainedInMap(normMnemonicArr, normWordListMap);\n            if (languageMatches) {\n                return replaceIncorrectlyAccentedWords(mnemonic, normMnemonicArr, normWordListMap);\n            }\n        }\n    }\n    return mnemonic;\n}\nexports.formatNonAccentedCharacters = formatNonAccentedCharacters;\nvar createNormalizedWordListMap = function (wordList) {\n    var normWordListMap = new Map();\n    for (var _i = 0, wordList_1 = wordList; _i < wordList_1.length; _i++) {\n        var word = wordList_1[_i];\n        var noramlizedWord = string_1.normalizeAccents(word);\n        normWordListMap.set(noramlizedWord, word);\n    }\n    return normWordListMap;\n};\nvar arrayContainedInMap = function (array, map) {\n    for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\n        var item = array_1[_i];\n        if (!map.has(item)) {\n            return false;\n        }\n    }\n    return true;\n};\nvar replaceIncorrectlyAccentedWords = function (mnemonic, normMnemonicArr, normWordListMap) {\n    var mnemonicArr = __spreadArrays(mnemonic.trim().split(' '));\n    for (var i = 0; i < normMnemonicArr.length; i += 1) {\n        var noramlizedWord = normMnemonicArr[i];\n        var nonNormalizedWord = normWordListMap.get(noramlizedWord);\n        if (nonNormalizedWord) {\n            mnemonicArr[i] = nonNormalizedWord;\n        }\n    }\n    return mnemonicArr.join(' ');\n};\nfunction generateKeys(mnemonic, password, changeIndex, addressIndex, bip39ToUse, derivationPath) {\n    if (changeIndex === void 0) { changeIndex = 0; }\n    if (addressIndex === void 0) { addressIndex = 0; }\n    if (bip39ToUse === void 0) { bip39ToUse = bip39Wrapper; }\n    if (derivationPath === void 0) { derivationPath = account_1.CELO_DERIVATION_PATH_BASE; }\n    return __awaiter(this, void 0, void 0, function () {\n        var seed;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, generateSeed(mnemonic, password, bip39ToUse)];\n                case 1:\n                    seed = _a.sent();\n                    return [2 /*return*/, generateKeysFromSeed(seed, changeIndex, addressIndex, derivationPath)];\n            }\n        });\n    });\n}\nexports.generateKeys = generateKeys;\nfunction generateDeterministicInviteCode(recipientPhoneHash, recipientPepper, addressIndex, changeIndex, derivationPath) {\n    if (addressIndex === void 0) { addressIndex = 0; }\n    if (changeIndex === void 0) { changeIndex = 0; }\n    if (derivationPath === void 0) { derivationPath = account_1.CELO_DERIVATION_PATH_BASE; }\n    var seed = ethereumjs_util_1.keccak256(recipientPhoneHash + recipientPepper);\n    return generateKeysFromSeed(seed, changeIndex, addressIndex, derivationPath);\n}\nexports.generateDeterministicInviteCode = generateDeterministicInviteCode;\n// keyByteLength truncates the seed. *Avoid its use*\n// It was added only because a backwards compatibility bug\nfunction generateSeed(mnemonic, password, bip39ToUse, keyByteLength) {\n    if (bip39ToUse === void 0) { bip39ToUse = bip39Wrapper; }\n    if (keyByteLength === void 0) { keyByteLength = 64; }\n    return __awaiter(this, void 0, void 0, function () {\n        var seed, bufAux;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, bip39ToUse.mnemonicToSeed(mnemonic, password)];\n                case 1:\n                    seed = _a.sent();\n                    if (keyByteLength > 0 && seed.byteLength > keyByteLength) {\n                        bufAux = Buffer.allocUnsafe(keyByteLength);\n                        seed.copy(bufAux, 0, 0, keyByteLength);\n                        seed = bufAux;\n                    }\n                    return [2 /*return*/, seed];\n            }\n        });\n    });\n}\nexports.generateSeed = generateSeed;\nfunction generateKeysFromSeed(seed, changeIndex, addressIndex, derivationPath) {\n    if (changeIndex === void 0) { changeIndex = 0; }\n    if (addressIndex === void 0) { addressIndex = 0; }\n    if (derivationPath === void 0) { derivationPath = account_1.CELO_DERIVATION_PATH_BASE; }\n    var node = bip32.fromSeed(seed);\n    var newNode = node.derivePath(derivationPath + \"/\" + changeIndex + \"/\" + addressIndex);\n    if (!newNode.privateKey) {\n        // As we are generating the node from a seed, the node will always have a private key and this would never happened\n        throw new Error('utils-accounts@generateKeys: invalid node to derivate');\n    }\n    return {\n        privateKey: newNode.privateKey.toString('hex'),\n        publicKey: newNode.publicKey.toString('hex'),\n        address: address_1.privateKeyToAddress(newNode.privateKey.toString('hex')),\n    };\n}\nexports.generateKeysFromSeed = generateKeysFromSeed;\nfunction isLatinBasedLanguage(language) {\n    if (language === account_1.MnemonicLanguages.chinese_simplified ||\n        language === account_1.MnemonicLanguages.chinese_traditional ||\n        language === account_1.MnemonicLanguages.japanese ||\n        language === account_1.MnemonicLanguages.korean) {\n        return false;\n    }\n    return true;\n}\n// Unify the bip39.wordlists (otherwise depends on the instance of the bip39)\nfunction getWordList(language) {\n    switch (language) {\n        case account_1.MnemonicLanguages.chinese_simplified:\n            return bip39.wordlists.chinese_simplified;\n        case account_1.MnemonicLanguages.chinese_traditional:\n            return bip39.wordlists.chinese_traditional;\n        case account_1.MnemonicLanguages.english:\n            return bip39.wordlists.english;\n        case account_1.MnemonicLanguages.french:\n            return bip39.wordlists.french;\n        case account_1.MnemonicLanguages.italian:\n            return bip39.wordlists.italian;\n        case account_1.MnemonicLanguages.japanese:\n            return bip39.wordlists.japanese;\n        case account_1.MnemonicLanguages.korean:\n            return bip39.wordlists.korean;\n        case account_1.MnemonicLanguages.spanish:\n            return bip39.wordlists.spanish;\n        default:\n            return bip39.wordlists.english;\n    }\n}\nfunction getAllLanguages() {\n    return [\n        account_1.MnemonicLanguages.chinese_simplified,\n        account_1.MnemonicLanguages.chinese_traditional,\n        account_1.MnemonicLanguages.english,\n        account_1.MnemonicLanguages.french,\n        account_1.MnemonicLanguages.italian,\n        account_1.MnemonicLanguages.japanese,\n        account_1.MnemonicLanguages.korean,\n        account_1.MnemonicLanguages.spanish,\n    ];\n}\nexports.AccountUtils = {\n    generateMnemonic: generateMnemonic,\n    validateMnemonic: validateMnemonic,\n    generateKeys: generateKeys,\n    generateSeed: generateSeed,\n    generateKeysFromSeed: generateKeysFromSeed,\n};\n//# sourceMappingURL=account.js.map"]},"metadata":{},"sourceType":"script"}