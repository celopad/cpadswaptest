{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar attestations_1 = require(\"@celo/base/lib/attestations\");\n\nvar web3_utils_1 = require(\"web3-utils\");\n\nvar address_1 = require(\"./address\");\n\nvar signatureUtils_1 = require(\"./signatureUtils\"); // Exports moved to @celo/base, forwarding them\n// here for backwards compatibility\n\n\nvar attestations_2 = require(\"@celo/base/lib/attestations\");\n\nexports.base64ToHex = attestations_2.base64ToHex;\nexports.extractAttestationCodeFromMessage = attestations_2.extractAttestationCodeFromMessage;\nexports.getIdentifierPrefix = attestations_2.getIdentifierPrefix;\nexports.IdentifierType = attestations_2.IdentifierType;\nexports.isAccountConsideredVerified = attestations_2.isAccountConsideredVerified;\nexports.messageContainsAttestationCode = attestations_2.messageContainsAttestationCode;\nexports.sanitizeMessageBase64 = attestations_2.sanitizeMessageBase64;\n\nvar sha3 = function (v) {\n  return web3_utils_1.soliditySha3({\n    type: 'string',\n    value: v\n  });\n};\n\nfunction hashIdentifier(identifier, type, salt) {\n  return attestations_1.hashIdentifier(sha3, identifier, type, salt);\n}\n\nexports.hashIdentifier = hashIdentifier;\n\nfunction getAttestationMessageToSignFromIdentifier(identifier, account) {\n  var messageHash = web3_utils_1.soliditySha3({\n    type: 'bytes32',\n    value: identifier\n  }, {\n    type: 'address',\n    value: account\n  });\n  return messageHash;\n}\n\nexports.getAttestationMessageToSignFromIdentifier = getAttestationMessageToSignFromIdentifier;\n\nfunction getAttestationMessageToSignFromPhoneNumber(phoneNumber, account, phoneSalt) {\n  return getAttestationMessageToSignFromIdentifier(hashIdentifier(phoneNumber, attestations_1.IdentifierType.PHONE_NUMBER, phoneSalt), account);\n}\n\nexports.getAttestationMessageToSignFromPhoneNumber = getAttestationMessageToSignFromPhoneNumber;\n\nfunction attestToIdentifier(identifier, account, privateKey) {\n  var issuer = address_1.privateKeyToAddress(privateKey);\n\n  var _a = signatureUtils_1.SignatureUtils.signMessage(getAttestationMessageToSignFromIdentifier(identifier, account), privateKey, issuer),\n      v = _a.v,\n      r = _a.r,\n      s = _a.s;\n\n  return {\n    v: v,\n    r: r,\n    s: s\n  };\n}\n\nexports.attestToIdentifier = attestToIdentifier;\n\nfunction extractSecurityCodeWithPrefix(message) {\n  var matches = message.match('(\\\\d{8})');\n\n  if (matches && matches.length === 2) {\n    return matches[1];\n  }\n\n  return null;\n}\n\nexports.extractSecurityCodeWithPrefix = extractSecurityCodeWithPrefix;\nexports.AttestationUtils = {\n  IdentifierType: attestations_1.IdentifierType,\n  getIdentifierPrefix: attestations_1.getIdentifierPrefix,\n  hashIdentifier: hashIdentifier,\n  getAttestationMessageToSignFromIdentifier: getAttestationMessageToSignFromIdentifier,\n  getAttestationMessageToSignFromPhoneNumber: getAttestationMessageToSignFromPhoneNumber,\n  base64ToHex: attestations_1.base64ToHex,\n  attestToIdentifier: attestToIdentifier,\n  sanitizeMessageBase64: attestations_1.sanitizeMessageBase64,\n  messageContainsAttestationCode: attestations_1.messageContainsAttestationCode,\n  extractAttestationCodeFromMessage: attestations_1.extractAttestationCodeFromMessage,\n  isAccountConsideredVerified: attestations_1.isAccountConsideredVerified,\n  extractSecurityCodeWithPrefix: extractSecurityCodeWithPrefix\n};","map":{"version":3,"sources":["../src/attestations.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar attestations_1 = require(\"@celo/base/lib/attestations\");\nvar web3_utils_1 = require(\"web3-utils\");\nvar address_1 = require(\"./address\");\nvar signatureUtils_1 = require(\"./signatureUtils\");\n// Exports moved to @celo/base, forwarding them\n// here for backwards compatibility\nvar attestations_2 = require(\"@celo/base/lib/attestations\");\nexports.base64ToHex = attestations_2.base64ToHex;\nexports.extractAttestationCodeFromMessage = attestations_2.extractAttestationCodeFromMessage;\nexports.getIdentifierPrefix = attestations_2.getIdentifierPrefix;\nexports.IdentifierType = attestations_2.IdentifierType;\nexports.isAccountConsideredVerified = attestations_2.isAccountConsideredVerified;\nexports.messageContainsAttestationCode = attestations_2.messageContainsAttestationCode;\nexports.sanitizeMessageBase64 = attestations_2.sanitizeMessageBase64;\nvar sha3 = function (v) { return web3_utils_1.soliditySha3({ type: 'string', value: v }); };\nfunction hashIdentifier(identifier, type, salt) {\n    return attestations_1.hashIdentifier(sha3, identifier, type, salt);\n}\nexports.hashIdentifier = hashIdentifier;\nfunction getAttestationMessageToSignFromIdentifier(identifier, account) {\n    var messageHash = web3_utils_1.soliditySha3({ type: 'bytes32', value: identifier }, { type: 'address', value: account });\n    return messageHash;\n}\nexports.getAttestationMessageToSignFromIdentifier = getAttestationMessageToSignFromIdentifier;\nfunction getAttestationMessageToSignFromPhoneNumber(phoneNumber, account, phoneSalt) {\n    return getAttestationMessageToSignFromIdentifier(hashIdentifier(phoneNumber, attestations_1.IdentifierType.PHONE_NUMBER, phoneSalt), account);\n}\nexports.getAttestationMessageToSignFromPhoneNumber = getAttestationMessageToSignFromPhoneNumber;\nfunction attestToIdentifier(identifier, account, privateKey) {\n    var issuer = address_1.privateKeyToAddress(privateKey);\n    var _a = signatureUtils_1.SignatureUtils.signMessage(getAttestationMessageToSignFromIdentifier(identifier, account), privateKey, issuer), v = _a.v, r = _a.r, s = _a.s;\n    return { v: v, r: r, s: s };\n}\nexports.attestToIdentifier = attestToIdentifier;\nfunction extractSecurityCodeWithPrefix(message) {\n    var matches = message.match('(\\\\d{8})');\n    if (matches && matches.length === 2) {\n        return matches[1];\n    }\n    return null;\n}\nexports.extractSecurityCodeWithPrefix = extractSecurityCodeWithPrefix;\nexports.AttestationUtils = {\n    IdentifierType: attestations_1.IdentifierType,\n    getIdentifierPrefix: attestations_1.getIdentifierPrefix,\n    hashIdentifier: hashIdentifier,\n    getAttestationMessageToSignFromIdentifier: getAttestationMessageToSignFromIdentifier,\n    getAttestationMessageToSignFromPhoneNumber: getAttestationMessageToSignFromPhoneNumber,\n    base64ToHex: attestations_1.base64ToHex,\n    attestToIdentifier: attestToIdentifier,\n    sanitizeMessageBase64: attestations_1.sanitizeMessageBase64,\n    messageContainsAttestationCode: attestations_1.messageContainsAttestationCode,\n    extractAttestationCodeFromMessage: attestations_1.extractAttestationCodeFromMessage,\n    isAccountConsideredVerified: attestations_1.isAccountConsideredVerified,\n    extractSecurityCodeWithPrefix: extractSecurityCodeWithPrefix,\n};\n//# sourceMappingURL=attestations.js.map"]},"metadata":{},"sourceType":"script"}